<div class="container mt-5">
  <h1 class="text-primary mb-4 text-center"><%= @post.title %></h1>

  <div class="card shadow-sm mb-4">
    <div class="card-body">
      <p class="mb-3"><%= @post.content %></p>

      <% if @post.images.attached? %>
        <div id="image-gallery" class="image-gallery d-flex flex-wrap justify-content-center">
          <% @post.images.each_with_index do |image, index| %>
            <div class="image-container" style="display: <% if index == 0 %>block<% else %>none<% end %>;">
              <%= image_tag image, class: "img-fluid mb-3", style: "max-height: 400px; object-fit: cover; width: auto;" %>
            </div>
          <% end %>
        </div>
        <div class="d-flex justify-content-between mt-3">
          <button id="prev-image" class="btn btn-secondary" style="display: none;">Previous</button>
          <button id="next-image" class="btn btn-secondary">Next</button>
        </div>
      <% else %>
        <%= image_tag "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTNNLEL-qmmLeFR1nxJuepFOgPYfnwHR56vcw&s", class: "img-fluid mb-3", style: "max-height: 400px; object-fit: cover; width: auto;" %>
      <% end %>
    </div>
  </div>

  <div class="my-4">
    <h3 class="text-secondary">Comments</h3>
    
    <%= form_with(model: [@post, @comment], local: true) do |form| %>
      <div class="mb-3">
        <%= form.label :content, "Your Comment", class: "form-label" %>
        <%= form.text_area :content, class: "form-control", rows: 3, required: true %>
      </div>
      <div class="d-flex justify-content-end">
        <%= form.submit "Add Comment", class: "btn btn-primary" %>
      </div>
    <% end %>

    <ul class="list-group mt-3">
      <% @post.comments.each do |comment| %>
        <li class="list-group-item d-flex justify-content-between align-items-center">
          <div>
            <strong><%= comment.user.email %>:</strong>
            <%= comment.content %>
          </div>

          <% if comment.user == current_user %>
            <div class="d-flex gap-2">
              <%= link_to 'Edit', edit_post_comment_path(@post, comment), class: 'btn btn-warning btn-sm' %>
              <%= link_to 'Delete', post_comment_path(@post, comment), data: { turbo_method: :delete, confirm: "Are you sure you want to delete this comment?" }, class: 'btn btn-danger btn-sm' %>
            </div>
          <% end %>
        </li>
      <% end %>
    </ul>
  </div>
</div>

<script>
  let currentImageIndex = 0;
  const images = document.querySelectorAll('.image-container');
  const nextButton = document.getElementById('next-image');
  const prevButton = document.getElementById('prev-image');

  function showImage(index) {
    images.forEach((image, i) => {
      image.style.display = i === index ? 'block' : 'none';
    });

    // Show or hide buttons based on index
    prevButton.style.display = index === 0 ? 'none' : 'inline-block';
    nextButton.style.display = index === images.length - 1 ? 'none' : 'inline-block';
  }

  nextButton.addEventListener('click', () => {
    if (currentImageIndex < images.length - 1) {
      currentImageIndex++;
      showImage(currentImageIndex);
    }
  });

  prevButton.addEventListener('click', () => {
    if (currentImageIndex > 0) {
      currentImageIndex--;
      showImage(currentImageIndex);
    }
  });

  // Initialize the first image
  showImage(currentImageIndex);
</script>
